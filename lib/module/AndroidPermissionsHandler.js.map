{"version":3,"names":["Linking","NativeModules","PermissionsAndroid","Platform","ANDROID_FINE_LOCATION","ANDROID_BACKGROUND_LOCATION","ANDROID_ACTIVITY_RECOGNITION","ZendrivePermissions","AndroidPermissionsHandler","openSettings","Promise","resolve","kind","basicPermissionGranted","fineLocation","backgroundLocation","check","OS","Version","console","log","checkOverlay","Error","rationale","hasAllGrants","getFineLocation","getBackgroundLocation","request","requestOverlay","openAdvancedBatterySettings"],"sources":["AndroidPermissionsHandler.ts"],"sourcesContent":["import {\n  Linking,\n  NativeModules,\n  PermissionsAndroid,\n  Platform,\n} from 'react-native';\nimport {\n  PermissionRationale,\n  ZendrivePermissions as IZendrivePermissions,\n  ZendriveRequiredPermission,\n} from './sdk/Zendrive';\n\nconst ANDROID_FINE_LOCATION = 'android.permission.ACCESS_FINE_LOCATION';\nconst ANDROID_BACKGROUND_LOCATION =\n  'android.permission.ACCESS_BACKGROUND_LOCATION';\nconst ANDROID_ACTIVITY_RECOGNITION = 'android.permission.ACTIVITY_RECOGNITION';\nconst ZendrivePermissions = NativeModules.ZendrivePermissions;\nexport default class AndroidPermissionsHandler implements IZendrivePermissions {\n  openSettings(): Promise<boolean> {\n    (Linking as any).openSettings();\n    return Promise.resolve(true);\n  }\n  async check(kind: ZendriveRequiredPermission): Promise<boolean> {\n    let basicPermissionGranted = false;\n    let fineLocation = false;\n    let backgroundLocation = true;\n\n    switch (kind) {\n      case 'location':\n        fineLocation = await PermissionsAndroid.check(ANDROID_FINE_LOCATION);\n        if (Platform.OS === 'android' && Platform.Version >= 29) {\n          console.log('Checking for background location');\n          backgroundLocation = await PermissionsAndroid.check(\n            // @ts-ignore\n            ANDROID_BACKGROUND_LOCATION\n          );\n        }\n        return Promise.resolve(fineLocation && backgroundLocation);\n      case 'motion':\n        if (Platform.OS === 'android' && Platform.Version >= 29) {\n          basicPermissionGranted = await PermissionsAndroid.check(\n            // @ts-ignore\n            ANDROID_ACTIVITY_RECOGNITION\n          );\n          return Promise.resolve(basicPermissionGranted);\n        }\n        return Promise.resolve(true);\n      case 'overlay':\n        return ZendrivePermissions.checkOverlay();\n      default:\n        throw new Error('not-yet-implemented');\n    }\n  }\n  async request(\n    kind: ZendriveRequiredPermission,\n    rationale?: PermissionRationale\n  ): Promise<boolean> {\n    if (Platform.OS === 'ios') {\n      throw new Error('Not yet implemented');\n    }\n    let basicPermissionGranted = 'denied';\n    let hasAllGrants = true;\n    let getFineLocation = '';\n    let getBackgroundLocation = '';\n    switch (kind) {\n      case 'location':\n        getFineLocation = await PermissionsAndroid.request(\n          ANDROID_FINE_LOCATION\n        );\n        getBackgroundLocation = await PermissionsAndroid.request(\n          // @ts-ignore\n          ANDROID_BACKGROUND_LOCATION\n        );\n        if (\n          getFineLocation === 'granted' &&\n          getBackgroundLocation === 'granted'\n        ) {\n          hasAllGrants = true;\n        } else {\n          hasAllGrants = false;\n        }\n        return Promise.resolve(hasAllGrants);\n      case 'motion':\n        if (Platform.OS === 'android' && Platform.Version >= 29) {\n          basicPermissionGranted = await PermissionsAndroid.request(\n            // @ts-ignore\n            ANDROID_ACTIVITY_RECOGNITION,\n            rationale\n          );\n          return Promise.resolve(basicPermissionGranted === 'granted');\n        }\n        return Promise.resolve(true);\n      case 'overlay':\n        return ZendrivePermissions.requestOverlay();\n      default:\n        throw new Error('not-yet-implemented');\n    }\n  }\n\n  async openAdvancedBatterySettings(): Promise<boolean> {\n    return ZendrivePermissions.openAdvancedBatterySettings();\n  }\n}\n"],"mappings":"4LAAA,OACEA,OAAO,CACPC,aAAa,CACbC,kBAAkB,CAClBC,QAAQ,KACH,cAAc,CAOrB,GAAMC,sBAAqB,CAAG,yCAAyC,CACvE,GAAMC,4BAA2B,CAC/B,+CAA+C,CACjD,GAAMC,6BAA4B,CAAG,yCAAyC,CAC9E,GAAMC,oBAAmB,CAAGN,aAAa,CAACM,mBAAmB,CAAC,GACzCC,0BAAyB,oKAC5C,uBAAiC,CAC9BR,OAAO,CAASS,YAAY,EAAE,CAC/B,MAAOC,QAAO,CAACC,OAAO,CAAC,IAAI,CAAC,CAC9B,CAAC,qBACD,eAAYC,IAAgC,2KACtCC,sBAAsB,CAAG,KAAK,CAC9BC,YAAY,CAAG,KAAK,CACpBC,kBAAkB,CAAG,IAAI,aAErBH,IAAI,6BACL,UAAU,iBAUV,QAAQ,kBASR,SAAS,qEAlBSV,kBAAkB,CAACc,KAAK,CAACZ,qBAAqB,CAAC,SAApEU,YAAY,oBACRX,QAAQ,CAACc,EAAE,GAAK,SAAS,EAAId,QAAQ,CAACe,OAAO,EAAI,EAAE,2BACrDC,OAAO,CAACC,GAAG,CAAC,kCAAkC,CAAC,CAAC,kDACrBlB,kBAAkB,CAACc,KAAK,CAEjDX,2BAA2B,CAC5B,UAHDU,kBAAkB,uDAKbL,OAAO,CAACC,OAAO,CAACG,YAAY,EAAIC,kBAAkB,CAAC,eAEtDZ,QAAQ,CAACc,EAAE,GAAK,SAAS,EAAId,QAAQ,CAACe,OAAO,EAAI,EAAE,6EACtBhB,kBAAkB,CAACc,KAAK,CAErDV,4BAA4B,CAC7B,UAHDO,sBAAsB,+CAIfH,OAAO,CAACC,OAAO,CAACE,sBAAsB,CAAC,0CAEzCH,OAAO,CAACC,OAAO,CAAC,IAAI,CAAC,0CAErBJ,mBAAmB,CAACc,YAAY,EAAE,eAEnC,IAAIC,MAAK,CAAC,qBAAqB,CAAC,sEAE3C,uBACD,iBACEV,IAAgC,CAChCW,SAA+B,wMAE3BpB,QAAQ,CAACc,EAAE,GAAK,KAAK,gCACjB,IAAIK,MAAK,CAAC,qBAAqB,CAAC,QAEpCT,sBAAsB,CAAG,QAAQ,CACjCW,YAAY,CAAG,IAAI,CACnBC,eAAe,CAAG,EAAE,CACpBC,qBAAqB,CAAG,EAAE,cACtBd,IAAI,+BACL,UAAU,kBAiBV,QAAQ,mBAUR,SAAS,uEA1BYV,kBAAkB,CAACyB,OAAO,CAChDvB,qBAAqB,CACtB,UAFDqB,eAAe,mEAGevB,kBAAkB,CAACyB,OAAO,CAEtDtB,2BAA2B,CAC5B,UAHDqB,qBAAqB,gBAIrB,GACED,eAAe,GAAK,SAAS,EAC7BC,qBAAqB,GAAK,SAAS,CACnC,CACAF,YAAY,CAAG,IAAI,CACrB,CAAC,IAAM,CACLA,YAAY,CAAG,KAAK,CACtB,CAAC,iCACMd,OAAO,CAACC,OAAO,CAACa,YAAY,CAAC,eAEhCrB,QAAQ,CAACc,EAAE,GAAK,SAAS,EAAId,QAAQ,CAACe,OAAO,EAAI,EAAE,+EACtBhB,kBAAkB,CAACyB,OAAO,CAEvDrB,4BAA4B,CAC5BiB,SAAS,CACV,UAJDV,sBAAsB,iDAKfH,OAAO,CAACC,OAAO,CAACE,sBAAsB,GAAK,SAAS,CAAC,2CAEvDH,OAAO,CAACC,OAAO,CAAC,IAAI,CAAC,2CAErBJ,mBAAmB,CAACqB,cAAc,EAAE,eAErC,IAAIN,MAAK,CAAC,qBAAqB,CAAC,uEAE3C,2CAED,+MACSf,mBAAmB,CAACsB,2BAA2B,EAAE,uEACzD,gDApFkBrB,yBAAyB"}